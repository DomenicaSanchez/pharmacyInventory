---
import type { Product } from "../types/Product.ts";
import Plus from "../components/Plus.astro";
import Remove from "./Remove.astro";
import Rest from "./Rest.astro";
import Modify from "./Modify.astro";

let products: Product[] = [];

try {
  const res = await fetch(
    `${import.meta.env.PUBLIC_API_URL || "http://localhost:3000"}/api/products`
  );
  products = await res.json();
} catch (err) {
  console.error("‚ùå Error cargando productos:", err);
}
---

<div class="overflow-x-auto">
  <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden">
    <thead class="text-center">
      <tr>
        {
          ["Code", "Name", "Stock", "Price", "Expires", "Actions"].map(
            (header) => (
              <th class="px-4 py-3 text-sm font-bold text-gray-500 font-trebuchet">
                {header}
              </th>
            )
          )
        }
      </tr>
    </thead>
    <tbody class="text-center divide-y divide-gray-200">
      {
        products.length > 0 ? (
          products.map((p: Product) => (
            <tr class="hover:bg-gray-50 transition-colors duration-150">
              <td class="p-3">{p.code}</td>
              <td>{p.name}</td>
              <td>{p.stock}</td>
              <td>${Number(p.price).toFixed(2)}</td>
              <td>{new Date(p.exp).toLocaleDateString()}</td>
              <td class="p-3 space-x-2 flex justify-center items-center">
                <Plus id={p.id} />
                <Modify id={p.id} />
                <Remove id={p.id} />
                <Rest id={p.id} />
              </td>
            </tr>
          ))
        ) : (
          <tr>
            <td colspan="6" class="p-4 text-gray-500 italic">
              No hay productos disponibles.
            </td>
          </tr>
        )
      }
    </tbody>
  </table>
</div>

<style>
  th,
  td {
    font-family: "Trebuchet MS", sans-serif;
  }
</style>
